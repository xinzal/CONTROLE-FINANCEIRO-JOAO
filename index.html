<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Controle Financeiro - Meses e Viagem BGS</title>
<style>
  :root{--bg:#f4f6f9;--card:#fff;--accent:#2c3e50;--ok:#2ecc71;--danger:#e74c3c}
  body{font-family:Inter,Segoe UI,Arial; background:var(--bg); margin:0; padding:18px; color:#222}
  header{display:flex;gap:12px;align-items:center;justify-content:space-between;max-width:1200px;margin:0 auto}
  h1{font-size:20px;margin:0;color:var(--accent)}
  .wrap{max-width:1200px;margin:14px auto}
  .card{background:var(--card);padding:14px;border-radius:10px;box-shadow:0 6px 20px rgba(0,0,0,0.06);margin-bottom:12px}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  input, select, button, textarea{padding:8px;border-radius:6px;border:1px solid #d0d4da;font-size:14px}
  button{cursor:pointer;background:var(--ok);color:#fff;border:none}
  button.ghost{background:transparent;border:1px solid #ccc;color:#333}
  button.danger{background:var(--danger)}
  table{width:100%;border-collapse:collapse;margin-top:10px}
  th,td{padding:8px;border-bottom:1px solid #eee;text-align:left}
  th{background:#f0f2f5}
  tr.pago{background:#eaf9ef;text-decoration:line-through;color:#444}
  .totals{display:flex;gap:12px;justify-content:flex-end;flex-wrap:wrap;margin-top:8px}
  .totbox{background:#fbfbfc;padding:10px;border-radius:8px;border:1px solid #eee;min-width:180px}
  nav.tabs{display:flex;gap:8px;margin-bottom:10px}
  nav.tabs button{background:#fff;border:1px solid #e6e9ee;padding:8px 12px;border-radius:8px;color:#333}
  nav.tabs button.active{background:var(--accent);color:#fff;border-color:var(--accent)}
  small.note{color:#666;display:block;margin-top:6px}
  .month-controls{display:flex;gap:8px;align-items:center}
  .right{margin-left:auto}
  .bgs-list{max-height:180px;overflow:auto;padding:6px;border-radius:6px;border:1px dashed #eee;background:#fff}
  .muted{color:#666;font-size:13px}
</style>
</head>
<body>
<header class="wrap">
  <h1>ðŸ’° Controle Financeiro â€” Meses & Viagem BGS</h1>
  <div class="row">
    <div class="month-controls card" style="display:flex;gap:8px;align-items:center">
      <label class="muted">MÃªs:</label>
      <select id="mesSelecionado"></select>
      <button onclick="novoMes()" title="Criar novo mÃªs com base no atual">âž• Novo MÃªs</button>
      <button class="ghost" onclick="exportarDados()">Exportar JSON</button>
    </div>
  </div>
</header>

<main class="wrap">
  <nav class="tabs card" role="tablist" aria-label="Abas">
    <button id="tabPrincipal" class="active" onclick="mostrarAba('principal')">Principal</button>
    <button id="tabViagem" onclick="mostrarAba('viagem')">Viagem BGS</button>
    <button id="tabHistorico" onclick="mostrarAba('historico')">HistÃ³rico MÃªs</button>
    <button id="tabCasa" onclick="mostrarAba('casa')">Caixinha Casa</button>
    <button id="tabCofre" onclick="mostrarAba('cofre')">Cofre JoÃ£o</button>
  </nav>

  <!-- PRINCIPAL -->
  <section id="aba-principal" class="card">
    <div class="row">
      <div style="flex:1;min-width:260px">
        <label><strong>SalÃ¡rio:</strong></label>
        <input id="salario" type="number" step="0.01" placeholder="R$ 0,00">
      </div>
      <div style="flex:1;min-width:260px">
        <label><strong>Renda Extra:</strong></label>
        <input id="rendaExtra" type="number" step="0.01" placeholder="R$ 0,00">
      </div>
      <div style="display:flex;align-items:end;">
        <button onclick="salvarEntradas()">Salvar Entradas</button>
      </div>
    </div>
    <small class="note">Saldo inicial = SalÃ¡rio + Renda Extra. Subtraia contas nÃ£o pagas e valores enviados para caixinhas. Depois 20% do que sobrou vai para Viagem BGS. O restante Ã© lazer.</small>

    <hr>

    <!-- adicionar item -->
    <div class="row" style="margin-top:6px">
      <input id="descricao" type="text" placeholder="DescriÃ§Ã£o (ex: TIM, Academia)">
      <input id="valor" type="number" step="0.01" placeholder="Valor R$">
      <select id="tipo">
        <option value="fixo">Fixo</option>
        <option value="variavel">VariÃ¡vel</option>
        <option value="cartao">CartÃ£o</option>
        <option value="viagem">Viagem</option>
        <option value="outro">Outro</option>
      </select>
      <input id="parcela" type="text" placeholder="Parcela (ex: 3/10) - opcional">
      <button onclick="adicionarItem()">Adicionar</button>
    </div>

    <!-- enviar para caixinhas -->
    <div class="row" style="margin-top:6px">
      <div style="flex:1;min-width:260px">
        <label><strong>Enviar para Caixinha Casa:</strong></label>
        <input id="valorCasa" type="number" step="0.01" placeholder="R$ 0,00">
      </div>
      <div style="flex:1;min-width:260px">
        <label><strong>Enviar para Cofre JoÃ£o:</strong></label>
        <input id="valorCofre" type="number" step="0.01" placeholder="R$ 0,00">
      </div>
      <div style="display:flex;align-items:end;">
        <button onclick="enviarParaCaixinhas()">Enviar Valores</button>
      </div>
    </div>

    <!-- tabela de itens -->
    <table id="tabela">
      <thead>
        <tr><th>DescriÃ§Ã£o</th><th>Valor (R$)</th><th>Tipo</th><th>Parcela</th><th>Pago?</th><th>AÃ§Ãµes</th></tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="totals" id="totaisArea">
      <div class="totbox">
        <div class="muted">Saldo Total Inicial</div>
        <div id="saldoTotalInicial">R$ 0,00</div>
      </div>
      <div class="totbox">
        <div class="muted">Subtotal apÃ³s contas nÃ£o pagas</div>
        <div id="saldoDepoisContas">R$ 0,00</div>
      </div>
      <div class="totbox">
        <div class="muted">Enviado para Caixinha Casa</div>
        <div id="enviadoCasa">R$ 0,00</div>
      </div>
      <div class="totbox">
        <div class="muted">Enviado para Cofre JoÃ£o</div>
        <div id="enviadoCofre">R$ 0,00</div>
      </div>
      <div class="totbox">
        <div class="muted">Saldo apÃ³s caixinhas</div>
        <div id="saldoDepoisCaixas">R$ 0,00</div>
      </div>
      <div class="totbox">
        <div class="muted">Valor reservado para Viagem BGS (20% do saldo restante)</div>
        <div id="valorBgsMes">R$ 0,00</div>
      </div>
      <div class="totbox">
        <div class="muted">Valor disponÃ­vel para lazer</div>
        <div id="valorLazer">R$ 0,00</div>
      </div>
    </div>
  </section>

  <!-- VIAGEM BGS -->
  <section id="aba-viagem" class="card" style="display:none">
    <h3>Viagem BGS â€” Acumulado</h3>
    <p class="muted">Total acumulado da Viagem BGS (20% do saldo apÃ³s caixinhas a cada mÃªs).</p>
    <div style="display:flex;gap:16px;align-items:center">
      <div style="flex:1">
        <div class="muted">Total acumulado:</div>
        <h2 id="bgsTotal">R$ 0,00</h2>
      </div>
      <div style="flex:1">
        <div class="muted">ContribuiÃ§Ãµes por mÃªs:</div>
        <div class="bgs-list" id="bgsContribList"></div>
      </div>
    </div>
  </section>

  <!-- CAIXINHA CASA -->
  <section id="aba-casa" class="card" style="display:none">
    <h3>Caixinha Casa â€” Acumulado</h3>
    <div style="display:flex;gap:16px;align-items:center">
      <div style="flex:1">
        <div class="muted">Total acumulado:</div>
        <h2 id="casaTotal">R$ 0,00</h2>
      </div>
      <div style="flex:1">
        <div class="muted">Valores enviados por mÃªs:</div>
        <div class="bgs-list" id="casaContribList"></div>
      </div>
    </div>
  </section>

  <!-- COFRE JOÃƒO -->
  <section id="aba-cofre" class="card" style="display:none">
    <h3>Cofre JoÃ£o â€” Acumulado</h3>
    <div style="display:flex;gap:16px;align-items:center">
      <div style="flex:1">
        <div class="muted">Total acumulado:</div>
        <h2 id="cofreTotal">R$ 0,00</h2>
      </div>
      <div style="flex:1">
        <div class="muted">Valores enviados por mÃªs:</div>
        <div class="bgs-list" id="cofreContribList"></div>
      </div>
    </div>
  </section>

  <!-- HISTÃ“RICO -->
  <section id="aba-historico" class="card" style="display:none">
    <h3>HistÃ³rico MÃªs</h3>
    <div class="muted">Aqui vocÃª pode ver e navegar pelos meses anteriores.</div>
  </section>
</main>

<script>
const STORAGE_MES_KEY = "mesesControle";
const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbxwGdIk-fpeNs39-kyUmmd6u5bL571_4Ei7qMuSjxdqDVly-Zg2DajBs2Mc15ZpP9X8/exec"; // substitua pelo URL do seu Web App

let meses = JSON.parse(localStorage.getItem(STORAGE_MES_KEY)) || {};
let mesAtual = new Date().toLocaleDateString("pt-BR",{month:"long",year:"numeric"});

const mesSelecionadoEl = document.getElementById("mesSelecionado");
const tabela = document.querySelector("#tabela tbody");

function atualizarMesesSelect(){
  mesSelecionadoEl.innerHTML = "";
  Object.keys(meses).forEach(m=>{
    const opt = document.createElement("option");
    opt.value = m; opt.textContent = m;
    if(m===mesAtual) opt.selected=true;
    mesSelecionadoEl.appendChild(opt);
  });
}
function mostrarAba(id){
  ["principal","viagem","historico","casa","cofre"].forEach(a=>{
    document.getElementById("aba-"+a).style.display = a===id?"block":"none";
    document.getElementById("tab"+(a==="principal"?"Principal":a.charAt(0).toUpperCase()+a.slice(1))).classList.toggle("active",a===id)
  })
}
function salvarMeses(obj){
  localStorage.setItem(STORAGE_MES_KEY,JSON.stringify(obj));
  // envia para planilha
  fetch(WEBAPP_URL,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify(obj)
  }).then(r=>r.json()).then(res=>console.log("Enviado:",res)).catch(e=>console.error("Erro:",e));
}
function novoMes(){
  if(meses[mesAtual]) meses[mesAtual]=JSON.parse(JSON.stringify(meses[mesAtual]));
  else meses[mesAtual]={itens:[],salario:0,rendaExtra:0,enviadoCasa:0,enviadoCofre:0,bgsDoMes:0,saldoAtual:0};
  atualizarMesesSelect(); salvarMeses(meses); renderTabela();
}
function adicionarItem(){
  const desc = document.getElementById("descricao").value;
  const valor = parseFloat(document.getElementById("valor").value)||0;
  const tipo = document.getElementById("tipo").value;
  const parcela = document.getElementById("parcela").value;
  if(!meses[mesAtual]) novoMes();
  meses[mesAtual].itens.push({descricao:desc,valor,parcela,tipo,pago:false});
  salvarMeses(meses); renderTabela();
}
function enviarParaCaixinhas(){
  if(!meses[mesAtual]) novoMes();
  meses[mesAtual].enviadoCasa=parseFloat(document.getElementById("valorCasa").value)||0;
  meses[mesAtual].enviadoCofre=parseFloat(document.getElementById("valorCofre").value)||0;
  salvarMeses(meses); renderTabela();
}
function salvarEntradas(){
  if(!meses[mesAtual]) novoMes();
  meses[mesAtual].salario=parseFloat(document.getElementById("salario").value)||0;
  meses[mesAtual].rendaExtra=parseFloat(document.getElementById("rendaExtra").value)||0;
  salvarMeses(meses); renderTabela();
}
function renderTabela(){
  tabela.innerHTML=""; const dados = meses[mesAtual]||{itens:[]};
  dados.itens.forEach((i,idx)=>{
    const tr=document.createElement("tr"); if(i.pago) tr.classList.add("pago");
    tr.innerHTML=`<td>${i.descricao}</td><td>${i.valor.toFixed(2)}</td><td>${i.tipo}</td><td>${i.parcela}</td><td>${i.pago?"Sim":"NÃ£o"}</td>
    <td><button onclick="togglePago(${idx})">Pago?</button></td>`;
    tabela.appendChild(tr);
  });
  // atualizar totais
  const salario=dados.salario||0,renda=dados.rendaExtra||0,enviadoCasa=dados.enviadoCasa||0,enviadoCofre=dados.enviadoCofre||0;
  let totalItens=dados.itens.reduce((a,i)=>i.pago?a:a+i.valor,0);
  let saldoInicial=salario+renda;
  let saldoDepoisContas=saldoInicial-totalItens;
  let saldoDepoisCaixas=saldoDepoisContas-enviadoCasa-enviadoCofre;
  let bgsDoMes=Math.round(saldoDepoisCaixas*0.2*100)/100;
  let valorLazer=Math.round((saldoDepoisCaixas-bgsDoMes)*100)/100;
  meses[mesAtual].bgsDoMes=bgsDoMes; meses[mesAtual].saldoAtual=saldoDepoisCaixas;
  document.getElementById("saldoTotalInicial").textContent="R$ "+saldoInicial.toFixed(2);
  document.getElementById("saldoDepoisContas").textContent="R$ "+saldoDepoisContas.toFixed(2);
  document.getElementById("enviadoCasa").textContent="R$ "+enviadoCasa.toFixed(2);
  document.getElementById("enviadoCofre").textContent="R$ "+enviadoCofre.toFixed(2);
  document.getElementById("saldoDepoisCaixas").textContent="R$ "+saldoDepoisCaixas.toFixed(2);
  document.getElementById("valorBgsMes").textContent="R$ "+bgsDoMes.toFixed(2);
  document.getElementById("valorLazer").textContent="R$ "+valorLazer.toFixed(2);
  renderBgs(); renderCasa(); renderCofre();
}
function togglePago(idx){meses[mesAtual].itens[idx].pago=!meses[mesAtual].itens[idx].pago; salvarMeses(meses); renderTabela();}
function renderBgs(){
  const listEl=document.getElementById("bgsContribList"); listEl.innerHTML=""; let total=0;
  Object.values(meses).forEach(m=>{total+=m.bgsDoMes||0; if(m.bgsDoMes) listEl.innerHTML+=`<div>${m.bgsDoMes.toFixed(2)}</div>`;});
  document.getElementById("bgsTotal").textContent="R$ "+total.toFixed(2);
}
function renderCasa(){
  const listEl=document.getElementById("casaContribList"); listEl.innerHTML=""; let total=0;
  Object.values(meses).forEach(m=>{total+=m.enviadoCasa||0; if(m.enviadoCasa) listEl.innerHTML+=`<div>${m.enviadoCasa.toFixed(2)}</div>`;});
  document.getElementById("casaTotal").textContent="R$ "+total.toFixed(2);
}
function renderCofre(){
  const listEl=document.getElementById("cofreContribList"); listEl.innerHTML=""; let total=0;
  Object.values(meses).forEach(m=>{total+=m.enviadoCofre||0; if(m.enviadoCofre) listEl.innerHTML+=`<div>${m.enviadoCofre.toFixed(2)}</div>`;});
  document.getElementById("cofreTotal").textContent="R$ "+total.toFixed(2);
}
function exportarDados(){const dataStr="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(meses)); const dl=document.createElement("a"); dl.setAttribute("href",dataStr); dl.setAttribute("download","meses.json"); dl.click();}
mesSelecionadoEl.addEventListener("change",e=>{mesAtual=e.target.value; renderTabela();});
atualizarMesesSelect(); renderTabela();
</script>
</body>
</html>
